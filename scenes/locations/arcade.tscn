[gd_scene load_steps=15 format=3 uid="uid://arcade"]

[ext_resource type="PackedScene" uid="uid://player_scene" path="res://scenes/player/Player.tscn" id="1_player"]
[ext_resource type="Script" path="res://scripts/world/spawn_point.gd" id="2_spawn"]
[ext_resource type="Script" path="res://scripts/interactables/sign.gd" id="3_sign"]
[ext_resource type="Script" path="res://scripts/interactables/door.gd" id="4_door"]
[ext_resource type="Script" path="res://scripts/interactables/npc.gd" id="5_npc"]
[ext_resource type="Script" path="res://scripts/interactables/quest_cabinet.gd" id="6_quest"]
[ext_resource type="Script" path="res://scripts/interactables/container.gd" id="7_container"]
[ext_resource type="Texture2D" path="res://assets/environments/arcade.jpg" id="8_bg"]
[ext_resource type="Script" path="res://scripts/interactables/claw_machine.gd" id="9_claw"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_door"]
size = Vector2(80, 40)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_cabinet"]
size = Vector2(60, 80)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_claw"]
size = Vector2(120, 150)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_counter"]
size = Vector2(120, 80)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_npc"]
size = Vector2(40, 40)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hollow"]
size = Vector2(80, 100)

[node name="Arcade" type="Node2D"]

[node name="Background" type="Sprite2D" parent="."]
position = Vector2(600, 448)
texture = ExtResource("8_bg")

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="FromTown" type="Marker2D" parent="SpawnPoints"]
position = Vector2(512, 680)
script = ExtResource("2_spawn")
spawn_id = "from_town"

[node name="Default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(512, 550)
script = ExtResource("2_spawn")
spawn_id = "default"

[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(512, 550)

[node name="Collisions" type="StaticBody2D" parent="."]

[node name="BackWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(100, 200, 1100, 200, 1100, 280, 100, 280)

[node name="LeftWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(50, 200, 130, 200, 130, 800, 50, 800)

[node name="RightWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(1070, 200, 1150, 200, 1150, 800, 1070, 800)

[node name="BottomWallLeft" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(50, 750, 420, 750, 420, 850, 50, 850)

[node name="BottomWallRight" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(600, 750, 1150, 750, 1150, 850, 600, 850)

[node name="BackCabinets" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(140, 280, 1060, 280, 1060, 400, 140, 400)

[node name="ClawMachine" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(280, 550, 420, 550, 420, 720, 280, 720)

[node name="TicketCounter" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(700, 550, 850, 550, 850, 650, 700, 650)

[node name="Interactables" type="Node2D" parent="."]

[node name="ExitDoor" type="Area2D" parent="Interactables"]
position = Vector2(512, 720)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/cloverhollow_town.tscn"
spawn_id = "from_arcade"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/ExitDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="TheHollow" type="Area2D" parent="Interactables"]
position = Vector2(150, 340)
collision_layer = 2
script = ExtResource("6_quest")
required_sigils = ["sigil_school", "sigil_town"]

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/TheHollow"]
shape = SubResource("RectangleShape2D_hollow")

[node name="ArcadeCabinet1" type="Area2D" parent="Interactables"]
position = Vector2(250, 340)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "SPACE BLASTERS - High Score: 999,999 by ???"

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/ArcadeCabinet1"]
shape = SubResource("RectangleShape2D_cabinet")

[node name="ArcadeCabinet2" type="Area2D" parent="Interactables"]
position = Vector2(340, 340)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "BURGER TIME - The screen flickers occasionally."

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/ArcadeCabinet2"]
shape = SubResource("RectangleShape2D_cabinet")

[node name="ArcadeCabinet3" type="Area2D" parent="Interactables"]
position = Vector2(512, 300)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "PAC-ATTACK - Someone scratched 'IT WATCHES' on the side."

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/ArcadeCabinet3"]
shape = SubResource("RectangleShape2D_cabinet")

[node name="ArcadeCabinet4" type="Area2D" parent="Interactables"]
position = Vector2(680, 340)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "DONKEY CLIMB - Classic! The joystick is a bit sticky though."

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/ArcadeCabinet4"]
shape = SubResource("RectangleShape2D_cabinet")

[node name="ArcadeCabinet5" type="Area2D" parent="Interactables"]
position = Vector2(770, 340)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "TETRIS EXTREME - So many high scores... all by 'FAE'. Wait, that's your name!"

[node name="CabinetCollision" type="CollisionShape2D" parent="Interactables/ArcadeCabinet5"]
shape = SubResource("RectangleShape2D_cabinet")

[node name="ClawMachine" type="Area2D" parent="Interactables"]
position = Vector2(350, 630)
collision_layer = 2
script = ExtResource("9_claw")

[node name="ClawCollision" type="CollisionShape2D" parent="Interactables/ClawMachine"]
shape = SubResource("RectangleShape2D_claw")

[node name="TicketCounter" type="Area2D" parent="Interactables"]
position = Vector2(775, 600)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "TICKET PRIZES: Candy (10), Stickers (25), Mysterious Orb (???)... The Mysterious Orb slot is empty."

[node name="CounterCollision" type="CollisionShape2D" parent="Interactables/TicketCounter"]
shape = SubResource("RectangleShape2D_counter")

[node name="ArcadeWorker" type="Area2D" parent="Interactables"]
position = Vector2(800, 520)
collision_layer = 2
script = ExtResource("5_npc")
npc_name = "Arcade Worker"
dialogue_lines = ["Welcome to PIXEL PARADISE!", "That cabinet in the corner? THE HOLLOW?", "Nobody's ever beaten it. The owner says it came with the building.", "Weird thing is... I don't remember it being there last month."]

[node name="WorkerCollision" type="CollisionShape2D" parent="Interactables/ArcadeWorker"]
shape = SubResource("RectangleShape2D_npc")

[node name="MysteriousStranger" type="Area2D" parent="Interactables"]
position = Vector2(500, 480)
collision_layer = 2
script = ExtResource("7_container")
container_id = "arcade_stranger_lantern"
item_id = "blacklight_lantern"
item_count = 1
loot_text = "The stranger hands you a strange lantern that glows purple. 'Use it to see what others cannot. Press [C] to toggle it on and off.'"
opened_text = "The stranger nods knowingly. 'You have what you need. Look for the signs... they're everywhere, if you know how to see.'"

[node name="StrangerCollision" type="CollisionShape2D" parent="Interactables/MysteriousStranger"]
shape = SubResource("RectangleShape2D_npc")
