[gd_scene load_steps=12 format=3 uid="uid://fw14h1tna36x"]

[ext_resource type="PackedScene" path="res://scenes/player/Player.tscn" id="1_player"]
[ext_resource type="Script" uid="uid://d1karbxyqsu24" path="res://scripts/world/spawn_point.gd" id="2_spawn"]
[ext_resource type="Script" uid="uid://djpct1dcayo4u" path="res://scripts/interactables/sign.gd" id="3_sign"]
[ext_resource type="Script" uid="uid://c3i6iyv6a1sqc" path="res://scripts/interactables/door.gd" id="4_door"]
[ext_resource type="Script" uid="uid://b066nf0p6ii4o" path="res://scripts/interactables/npc.gd" id="5_npc"]
[ext_resource type="Script" uid="uid://drhll6gqhsp54" path="res://scripts/interactables/container.gd" id="6_container"]
[ext_resource type="Script" uid="uid://dkdcwdus5p2dm" path="res://scripts/interactables/hidden_sigil.gd" id="7_sigil"]
[ext_resource type="Texture2D" uid="uid://ddk6jp3gc8gnf" path="res://assets/environments/cloverhollow_town.jpg" id="8_bg"]

[sub_resource type="RectangleShape2D" id="shape_door"]
size = Vector2(80, 60)

[sub_resource type="RectangleShape2D" id="shape_interact"]
size = Vector2(50, 40)

[sub_resource type="CircleShape2D" id="shape_npc"]
radius = 20.0

[node name="CloverHollowTown" type="Node2D"]

[node name="Background" type="Sprite2D" parent="."]
position = Vector2(704, 384)
texture = ExtResource("8_bg")

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="FromFaeHouse" type="Marker2D" parent="SpawnPoints"]
position = Vector2(330, 440)
script = ExtResource("2_spawn")
spawn_id = "from_fae_house"

[node name="FromSchool" type="Marker2D" parent="SpawnPoints"]
position = Vector2(790, 410)
script = ExtResource("2_spawn")
spawn_id = "from_school"

[node name="FromArcade" type="Marker2D" parent="SpawnPoints"]
position = Vector2(1160, 460)
script = ExtResource("2_spawn")
spawn_id = "from_arcade"

[node name="FromCafe" type="Marker2D" parent="SpawnPoints"]
position = Vector2(260, 680)
script = ExtResource("2_spawn")
spawn_id = "from_cafe"

[node name="FromStore" type="Marker2D" parent="SpawnPoints"]
position = Vector2(1220, 680)
script = ExtResource("2_spawn")
spawn_id = "from_store"

[node name="Default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(768, 500)
script = ExtResource("2_spawn")
spawn_id = "default"

[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(768, 500)

[node name="Collisions" type="StaticBody2D" parent="."]

[node name="FaeHouse" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(120, 200, 450, 200, 450, 360, 120, 360)

[node name="School" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(580, 180, 1000, 180, 1000, 330, 580, 330)

[node name="Arcade" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(1050, 220, 1400, 220, 1400, 380, 1050, 380)

[node name="Cafe" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(100, 580, 380, 580, 380, 700, 100, 700)

[node name="GeneralStore" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(1100, 580, 1420, 580, 1420, 700, 1100, 700)

[node name="Fountain" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(680, 420, 860, 420, 900, 480, 900, 560, 860, 620, 680, 620, 640, 560, 640, 480)

[node name="TopBorder" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(0, 0, 1536, 0, 1536, 160, 0, 160)

[node name="BottomBorder" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(0, 760, 1536, 760, 1536, 850, 0, 850)

[node name="LeftBorder" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(0, 0, 80, 0, 80, 850, 0, 850)

[node name="RightBorder" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(1456, 0, 1536, 0, 1536, 850, 1456, 850)

[node name="Interactables" type="Node2D" parent="."]

[node name="FaeHouseDoor" type="Area2D" parent="Interactables"]
position = Vector2(330, 390)
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/fae_hall.tscn"
spawn_id = "from_town"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/FaeHouseDoor"]
shape = SubResource("shape_door")

[node name="SchoolDoor" type="Area2D" parent="Interactables"]
position = Vector2(790, 360)
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_hall.tscn"
spawn_id = "from_town"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/SchoolDoor"]
shape = SubResource("shape_door")

[node name="ArcadeDoor" type="Area2D" parent="Interactables"]
position = Vector2(1160, 410)
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/arcade.tscn"
spawn_id = "from_town"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/ArcadeDoor"]
shape = SubResource("shape_door")

[node name="CafeDoor" type="Area2D" parent="Interactables"]
position = Vector2(260, 720)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "CLOVER CAFÃ‰ - Closed for renovations. The barista left a note: 'Back soon! Try the candy from the mailbox!'"

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/CafeDoor"]
shape = SubResource("shape_door")

[node name="StoreDoor" type="Area2D" parent="Interactables"]
position = Vector2(1220, 720)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "CLOVER GOODS - General Store. The door is locked. A sign says: 'Gone fishing. Back whenever.'"

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/StoreDoor"]
shape = SubResource("shape_door")

[node name="TownSign" type="Area2D" parent="Interactables"]
position = Vector2(768, 700)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "Welcome to CLOVERHOLLOW - Where Every Day is a Little Weird!"

[node name="SignCollision" type="CollisionShape2D" parent="Interactables/TownSign"]
shape = SubResource("shape_interact")

[node name="Mailbox" type="Area2D" parent="Interactables"]
position = Vector2(400, 420)
collision_layer = 2
script = ExtResource("6_container")
container_id = "town_mailbox"
item_id = "candy"
item_count = 3
opened_text = "The mailbox is empty now."
loot_text = "Found 3 pieces of Candy! Who leaves candy in a mailbox?"

[node name="MailboxCollision" type="CollisionShape2D" parent="Interactables/Mailbox"]
shape = SubResource("shape_interact")

[node name="OldMan" type="Area2D" parent="Interactables"]
position = Vector2(500, 550)
collision_layer = 2
script = ExtResource("5_npc")
npc_name = "Old Timer"
dialogue_lines = Array[String](["Back in my day, the Arcade didn't have those... strange cabinets.", "Something's not right about that new machine.", "I swear I saw it GLOW last night..."])

[node name="NPCCollision" type="CollisionShape2D" parent="Interactables/OldMan"]
shape = SubResource("shape_npc")

[node name="Kid" type="Area2D" parent="Interactables"]
position = Vector2(1000, 500)
collision_layer = 2
script = ExtResource("5_npc")
npc_name = "Timmy"
dialogue_lines = Array[String](["Have you been to the Arcade yet?", "There's this one cabinet that nobody can beat...", "It's called 'THE HOLLOW'. Creepy name, right?"])

[node name="NPCCollision" type="CollisionShape2D" parent="Interactables/Kid"]
shape = SubResource("shape_npc")

[node name="HiddenSigil" type="Area2D" parent="Interactables"]
position = Vector2(768, 620)
collision_layer = 2
script = ExtResource("7_sigil")
sigil_id = "sigil_town"
hidden_text = "Glowing symbols appear on the ground... They form a spiral, pulling your gaze inward."
revealed_text = "The Spiral of the Town. It marks a place between worlds."

[node name="SigilCollision" type="CollisionShape2D" parent="Interactables/HiddenSigil"]
shape = SubResource("shape_interact")
