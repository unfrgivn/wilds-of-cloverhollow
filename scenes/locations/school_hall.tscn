[gd_scene load_steps=15 format=3 uid="uid://cwymxaw5ateyg"]

[ext_resource type="PackedScene" path="res://scenes/player/Player.tscn" id="1_player"]
[ext_resource type="Script" uid="uid://d1karbxyqsu24" path="res://scripts/world/spawn_point.gd" id="2_spawn"]
[ext_resource type="Script" uid="uid://djpct1dcayo4u" path="res://scripts/interactables/sign.gd" id="3_sign"]
[ext_resource type="Script" uid="uid://c3i6iyv6a1sqc" path="res://scripts/interactables/door.gd" id="4_door"]
[ext_resource type="Script" uid="uid://drhll6gqhsp54" path="res://scripts/interactables/container.gd" id="5_container"]
[ext_resource type="Script" uid="uid://dkdcwdus5p2dm" path="res://scripts/interactables/hidden_sigil.gd" id="6_sigil"]
[ext_resource type="Texture2D" uid="uid://chp4s3wyl67tl" path="res://assets/environments/school_hall.jpg" id="7_bg"]
[ext_resource type="Script" uid="uid://b066nf0p6ii4o" path="res://scripts/interactables/npc.gd" id="8_npc"]
[ext_resource type="Texture2D" uid="uid://70pp04xuc7th" path="res://assets/sprites/npcs/kid.png" id="9_classmate"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_exit_door"]
size = Vector2(106, 45)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_stairs_door"]
size = Vector2(106, 45)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_principal_door"]
size = Vector2(106, 45)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_prop"]
size = Vector2(58, 64)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lockers"]
size = Vector2(40, 120)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_sigil"]
size = Vector2(50, 50)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_closet"]
size = Vector2(68, 50)

[node name="SchoolHall" type="Node2D"]

[node name="Background" type="Sprite2D" parent="."]
position = Vector2(704, 384)
texture = ExtResource("7_bg")

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="FromTown" type="Marker2D" parent="SpawnPoints"]
position = Vector2(221, 477)
script = ExtResource("2_spawn")
spawn_id = "from_town"

[node name="Default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(486, 360)
script = ExtResource("2_spawn")
spawn_id = "default"

[node name="FromStairs" type="Marker2D" parent="SpawnPoints"]
position = Vector2(1124, 713)
script = ExtResource("2_spawn")
spawn_id = "from_stairs"

[node name="FromPrincipal" type="Marker2D" parent="SpawnPoints"]
position = Vector2(921, 506)
script = ExtResource("2_spawn")
spawn_id = "from_principal"

[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(487, 361)

[node name="Collisions" type="StaticBody2D" parent="."]

[node name="LeftLockers" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(-129, -50)
polygon = PackedVector2Array(180, 480, 256, 522, 244, 576, 141, 528)

[node name="RightLockers" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(235, -186)
polygon = PackedVector2Array(825, 585, 1045, 707, 1036, 757, 827, 684)

[node name="TopWall" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(391, 95)
polygon = PackedVector2Array(109, -119, 1000, 350, 996, 491, 46, 3, 41, -120)

[node name="LeftWall" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(-143, -315)
polygon = PackedVector2Array(120, 350, 200, 350, 496, 335, 484, 482, 216, 594, 200, 800, 120, 800)

[node name="RightWall" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(353, 8)
polygon = PackedVector2Array(1000, 350, 1080, 350, 1080, 800, 1000, 800)

[node name="BottomWall" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(120, -220)
polygon = PackedVector2Array(163, 629, 698, 938, 681, 987, 431, 994, 140, 778)

[node name="BottomWallRight" type="CollisionPolygon2D" parent="Collisions"]
position = Vector2(103, -17)
polygon = PackedVector2Array(700, 780, 1080, 780, 1080, 850, 700, 850)

[node name="Interactables" type="Node2D" parent="."]

[node name="ExitDoor" type="Area2D" parent="Interactables"]
position = Vector2(185, 516)
rotation = 0.5549957
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/cloverhollow_town.tscn"
spawn_id = "from_school"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/ExitDoor"]
shape = SubResource("RectangleShape2D_exit_door")

[node name="BulletinBoard" type="Area2D" parent="Interactables"]
position = Vector2(535, 159)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "NOTICE: Festival volunteers needed! Also, has anyone seen the janitor's blacklight? - Principal"

[node name="BoardCollision" type="CollisionShape2D" parent="Interactables/BulletinBoard"]
position = Vector2(21.999998, 30)
rotation = 0.28543204
shape = SubResource("RectangleShape2D_prop")

[node name="TrophyCase" type="Area2D" parent="Interactables"]
position = Vector2(760, 340)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "Cloverhollow Spelling Bee Champions 1987-2024. One trophy has a strange symbol scratched into it..."

[node name="TrophyCollision" type="CollisionShape2D" parent="Interactables/TrophyCase"]
shape = SubResource("RectangleShape2D_prop")

[node name="Lockers" type="Area2D" parent="Interactables"]
position = Vector2(232, 303)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "Rows of lockers. Most are locked, but one has a faint glow coming from inside..."

[node name="LockerCollision" type="CollisionShape2D" parent="Interactables/Lockers"]
position = Vector2(26, -11)
shape = SubResource("RectangleShape2D_lockers")

[node name="HiddenSigil" type="Area2D" parent="Interactables"]
position = Vector2(870, 740)
collision_layer = 2
script = ExtResource("6_sigil")
sigil_id = "sigil_school"
hidden_text = "Under the blacklight, strange symbols glow on the wall... They form an eye, watching."
revealed_text = "The Eye of the School. It sees all who pass through these halls."

[node name="SigilCollision" type="CollisionShape2D" parent="Interactables/HiddenSigil"]
shape = SubResource("RectangleShape2D_sigil")

[node name="JanitorCloset" type="Area2D" parent="Interactables"]
position = Vector2(391, 196)
collision_layer = 2
script = ExtResource("5_container")
container_id = "school_janitor_closet"
item_id = "blacklight_lantern"
opened_text = "An empty closet. Smells like cleaning supplies."
loot_text = "Found the Blacklight Lantern! It hums softly in your hands..."

[node name="ClosetCollision" type="CollisionShape2D" parent="Interactables/JanitorCloset"]
position = Vector2(-2, -4)
shape = SubResource("RectangleShape2D_closet")

[node name="StairwellDoor" type="Area2D" parent="Interactables"]
position = Vector2(1246, 751)
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_stairwell.tscn"
spawn_id = "from_first_floor"
is_automatic = true

[node name="StairsDoorCollision" type="CollisionShape2D" parent="Interactables/StairwellDoor"]
position = Vector2(-5, 5)
shape = SubResource("RectangleShape2D_stairs_door")

[node name="PrincipalOfficeDoor" type="Area2D" parent="Interactables"]
position = Vector2(948, 459)
collision_layer = 2
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_principal_office.tscn"
spawn_id = "from_hall"
is_automatic = true

[node name="PrincipalDoorCollision" type="CollisionShape2D" parent="Interactables/PrincipalOfficeDoor"]
shape = SubResource("RectangleShape2D_principal_door")

[node name="ClassmateJenny" type="Area2D" parent="Interactables"]
position = Vector2(647, 296)
collision_layer = 2
script = ExtResource("8_npc")
npc_name = "Jenny"
dialogue_lines = Array[String](["Hi Fae! Are you ready for the festival?", "I heard there's going to be a treasure hunt!", "Maybe we can team up!"])

[node name="JennySprite" type="Sprite2D" parent="Interactables/ClassmateJenny"]
scale = Vector2(0.12, 0.12)
texture = ExtResource("9_classmate")

[node name="JennyCollision" type="CollisionShape2D" parent="Interactables/ClassmateJenny"]
position = Vector2(-3, 0)
shape = SubResource("RectangleShape2D_prop")
