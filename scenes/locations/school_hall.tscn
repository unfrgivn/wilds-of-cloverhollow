[gd_scene load_steps=13 format=3 uid="uid://school_hall"]

[ext_resource type="PackedScene" uid="uid://player_scene" path="res://scenes/player/Player.tscn" id="1_player"]
[ext_resource type="Script" path="res://scripts/world/spawn_point.gd" id="2_spawn"]
[ext_resource type="Script" path="res://scripts/interactables/sign.gd" id="3_sign"]
[ext_resource type="Script" path="res://scripts/interactables/door.gd" id="4_door"]
[ext_resource type="Script" path="res://scripts/interactables/container.gd" id="5_container"]
[ext_resource type="Script" path="res://scripts/interactables/hidden_sigil.gd" id="6_sigil"]
[ext_resource type="Texture2D" path="res://assets/environments/school_hall.jpg" id="7_bg"]
[ext_resource type="Script" path="res://scripts/interactables/npc.gd" id="8_npc"]
[ext_resource type="Texture2D" path="res://assets/sprites/npcs/kid.png" id="9_classmate"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_door"]
size = Vector2(80, 40)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_prop"]
size = Vector2(60, 50)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lockers"]
size = Vector2(40, 120)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_sigil"]
size = Vector2(50, 50)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_closet"]
size = Vector2(50, 40)

[node name="SchoolHall" type="Node2D"]

[node name="Background" type="Sprite2D" parent="."]
position = Vector2(704, 384)
texture = ExtResource("7_bg")

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="FromTown" type="Marker2D" parent="SpawnPoints"]
position = Vector2(600, 700)
script = ExtResource("2_spawn")
spawn_id = "from_town"

[node name="Default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(600, 550)
script = ExtResource("2_spawn")
spawn_id = "default"

[node name="FromHomeroom" type="Marker2D" parent="SpawnPoints"]
position = Vector2(300, 480)
script = ExtResource("2_spawn")
spawn_id = "from_homeroom"

[node name="FromMusic" type="Marker2D" parent="SpawnPoints"]
position = Vector2(500, 480)
script = ExtResource("2_spawn")
spawn_id = "from_music"

[node name="FromArt" type="Marker2D" parent="SpawnPoints"]
position = Vector2(700, 480)
script = ExtResource("2_spawn")
spawn_id = "from_art"

[node name="FromNurse" type="Marker2D" parent="SpawnPoints"]
position = Vector2(900, 480)
script = ExtResource("2_spawn")
spawn_id = "from_nurse"

[node name="FromStairs" type="Marker2D" parent="SpawnPoints"]
position = Vector2(950, 550)
script = ExtResource("2_spawn")
spawn_id = "from_stairs"

[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(600, 550)

[node name="Collisions" type="StaticBody2D" parent="."]

[node name="LeftLockers" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(180, 480, 380, 480, 380, 720, 180, 720)

[node name="RightLockers" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(820, 480, 1020, 480, 1020, 720, 820, 720)

[node name="TopWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(200, 350, 1000, 350, 1000, 420, 200, 420)

[node name="LeftWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(120, 350, 200, 350, 200, 800, 120, 800)

[node name="RightWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(1000, 350, 1080, 350, 1080, 800, 1000, 800)

[node name="BottomWall" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(120, 780, 500, 780, 500, 850, 120, 850)

[node name="BottomWallRight" type="CollisionPolygon2D" parent="Collisions"]
polygon = PackedVector2Array(700, 780, 1080, 780, 1080, 850, 700, 850)

[node name="Interactables" type="Node2D" parent="."]

[node name="ExitDoor" type="Area2D" parent="Interactables"]
position = Vector2(600, 760)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/cloverhollow_town.tscn"
spawn_id = "from_school"
is_automatic = true

[node name="DoorCollision" type="CollisionShape2D" parent="Interactables/ExitDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="BulletinBoard" type="Area2D" parent="Interactables"]
position = Vector2(400, 440)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "NOTICE: Festival volunteers needed! Also, has anyone seen the janitor's blacklight? - Principal"

[node name="BoardCollision" type="CollisionShape2D" parent="Interactables/BulletinBoard"]
shape = SubResource("RectangleShape2D_prop")

[node name="TrophyCase" type="Area2D" parent="Interactables"]
position = Vector2(600, 400)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "Cloverhollow Spelling Bee Champions 1987-2024. One trophy has a strange symbol scratched into it..."

[node name="TrophyCollision" type="CollisionShape2D" parent="Interactables/TrophyCase"]
shape = SubResource("RectangleShape2D_prop")

[node name="Lockers" type="Area2D" parent="Interactables"]
position = Vector2(280, 600)
collision_layer = 2
script = ExtResource("3_sign")
sign_text = "Rows of lockers. Most are locked, but one has a faint glow coming from inside..."

[node name="LockerCollision" type="CollisionShape2D" parent="Interactables/Lockers"]
shape = SubResource("RectangleShape2D_lockers")

[node name="HiddenSigil" type="Area2D" parent="Interactables"]
position = Vector2(920, 600)
collision_layer = 2
script = ExtResource("6_sigil")
sigil_id = "sigil_school"
hidden_text = "Under the blacklight, strange symbols glow on the wall... They form an eye, watching."
revealed_text = "The Eye of the School. It sees all who pass through these halls."

[node name="SigilCollision" type="CollisionShape2D" parent="Interactables/HiddenSigil"]
shape = SubResource("RectangleShape2D_sigil")

[node name="JanitorCloset" type="Area2D" parent="Interactables"]
position = Vector2(200, 700)
collision_layer = 2
script = ExtResource("5_container")
container_id = "school_janitor_closet"
item_id = "blacklight_lantern"
item_count = 1
loot_text = "Found the Blacklight Lantern! It hums softly in your hands..."
opened_text = "An empty closet. Smells like cleaning supplies."

[node name="ClosetCollision" type="CollisionShape2D" parent="Interactables/JanitorCloset"]
shape = SubResource("RectangleShape2D_closet")

[node name="HomeroomDoor" type="Area2D" parent="Interactables"]
position = Vector2(300, 420)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_homeroom.tscn"
spawn_id = "from_hall"

[node name="HomeroomDoorCollision" type="CollisionShape2D" parent="Interactables/HomeroomDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="MusicRoomDoor" type="Area2D" parent="Interactables"]
position = Vector2(500, 420)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_music_room.tscn"
spawn_id = "from_hall"

[node name="MusicDoorCollision" type="CollisionShape2D" parent="Interactables/MusicRoomDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="ArtRoomDoor" type="Area2D" parent="Interactables"]
position = Vector2(700, 420)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_art_room.tscn"
spawn_id = "from_hall"

[node name="ArtDoorCollision" type="CollisionShape2D" parent="Interactables/ArtRoomDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="NurseOfficeDoor" type="Area2D" parent="Interactables"]
position = Vector2(900, 420)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_nurse_office.tscn"
spawn_id = "from_hall"

[node name="NurseDoorCollision" type="CollisionShape2D" parent="Interactables/NurseOfficeDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="StairwellDoor" type="Area2D" parent="Interactables"]
position = Vector2(1050, 550)
collision_layer = 2
collision_mask = 1
script = ExtResource("4_door")
target_scene = "res://scenes/locations/school_stairwell.tscn"
spawn_id = "from_first_floor"

[node name="StairsDoorCollision" type="CollisionShape2D" parent="Interactables/StairwellDoor"]
shape = SubResource("RectangleShape2D_door")

[node name="ClassmateJenny" type="Area2D" parent="Interactables"]
position = Vector2(450, 600)
collision_layer = 2
script = ExtResource("8_npc")
npc_name = "Jenny"
dialogue_lines = Array[String](["Hi Fae! Are you ready for the festival?", "I heard there's going to be a treasure hunt!", "Maybe we can team up!"])

[node name="JennySprite" type="Sprite2D" parent="Interactables/ClassmateJenny"]
scale = Vector2(0.12, 0.12)
texture = ExtResource("9_classmate")

[node name="JennyCollision" type="CollisionShape2D" parent="Interactables/ClassmateJenny"]
shape = SubResource("RectangleShape2D_prop")
